<!DOCTYPE html> 
<html> 
  <head> 
  <meta name="viewport" content="height=device-height,width=device-width,initial-scale=1.0,maximum-scale=1.0" >
  <meta name="viewport" content="initial-scale=1, maximum-scale=1">

  <title>Class Tempo: Login</title> 

  <!-- CSS -->
  <link rel="stylesheet" href="./signup.css">
  <link rel="stylesheet" href="./teacher-theme/themes/Class-Tempo-Teacher.min.css" />
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.1/jquery.mobile.structure-1.1.1.min.css" />
 <!--  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.css" /> -->
  <link rel="stylesheet" type="text/css" href="simpleDialog2/jquery.mobile.simpledialog.min.css" /> 

  <!-- Modernizer -->
  <script type="text/javascript" src="./modernizr.custom.56582.js"></script>

  <!-- jQuery/jQuery Mobile -->
  <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.js"></script>

   <!-- simpleDiaglo2 -->
  <script src="simpleDialog2/jquery.mobile.simpledialog2.min.js"></script>

    <!-- jqPlot -->
  <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="js/excanvas.js"></script><![endif]-->
  <script language="javascript" type="text/javascript" src="js/jquery.jqplot.min.js"></script>
  <link rel="stylesheet" type="text/css" href="js/jquery.jqplot.css" />

  <script language="javascript" type="text/javascript" src="js/plugins/jqplot.barRenderer.js"></script>
  <script language="javascript" type="text/javascript" src="js/plugins/jqplot.barRenderer.min.js"></script>
  <script language="javascript" type="text/javascript" src="js/plugins/jqplot.categoryAxisRenderer.js"></script>
  <script language="javascript" type="text/javascript" src="js/plugins/jqplot.pointLabels.js"></script>
  <script language="javascript" type="text/javascript" src="js/plugins/jqplot.pointLabels.min.js"></script>

<!-- Page starts here -->
<div data-role="page" data-theme="a" id="teacherPage" data-add-back-btn="true">
  
  <script>   

   // Global declarations - assignments made in $(document).ready() below
    
    // Used for teacher.html to log in
    var emailVar = null;
    var  passwordVar = null;
    var userTagVar = null;

    // Global vars used in surveyCreator.html
    var sliderValue = null;
    var numbersOrLetters = null;
    var onOffValue = null;
    var surveyDescriptionVar = null;

    // Global var used in surveyList.html
    // to retrieve a survey to display analytics
    var surveyId = null;

    // used in surveyList.html to pass to surveyResults.html
    // to determine flip toggle in surveyResults.html
    var surveyOnorOff = null;
    var teacherFormVar = null;
    var MISSING = "missing";
    var EMPTY = "";

    function showSimpleDialogue(alertHeader, alertMessage) {
    
    $('<div>').simpledialog2({
                    mode: 'button',
                    headerText: alertHeader,
                    buttonPrompt: alertMessage,
                    headerClose: false,
                    buttons : {
                      'OK': {
                        click: function () { 
                        }
                      }
                    }
             })
 }

  </script>

<!-- Google Analytics -->

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-35289882-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</head> 
<body> 

  <div data-role="header" id="hdrMain" name="hdrMain">
    <h1>Class Tempo</h1>
  </div>

      <div data-role="navbar" id="navar">
      <ul>
        <li><a href="" data-icon="" data-transition="fade" class="ui-btn-active ui-state-persist">Sign-In</a></li>
        <li><a href="signUp.html" rel="external" data-icon="" data-transition="fade">Sign-Up</a></li>
      </ul>
    </div>


  <div data-role="content" id="contentMain" name="contentMain"> 

  <form id="teacherForm">
  
  <div id="emailDiv" data-role="fieldcontain">
    <label for="email">Email</label>   
    <input id="email" name="email_r" type="text" />
  </div>

  <div id="passwordDiv" data-role="fieldcontain">
    <label for="password">Password</label>   
    <input id="password" name="password_r" type="password" />
  </div>

    <div id="signInDiv" data-role="fieldcontain">    
     <input type="submit" value="Sign In" data-inline="true"/>
    </div>

    <p><a href="forgotPassword.html">Forgot your password?</a></p>
    </form>
  </div><!-- contentMain -->
  
  <script>

     $('#teacherPage').on('pageinit', function() {
   // $(document).ready(function() {
    
    // Assign global variables
      emailVar = $('#email');
      passwordVar = $('#password');
      teacherFormVar = $('#teacherForm');
    }); 
    
    $('#teacherForm').submit(function() {

      if (window.navigator.onLine != false) {

        var emtpyError = false;
        emailVar = $('#email');
        passwordVar = $('#password');
        teacherFormVar = $('#teacherForm');


       if ((emailVar != undefined) && (passwordVar != undefined))  {

        if ((emailVar.val() == EMPTY) || (passwordVar.val() == EMPTY)){

        	emtpyError = true;
          }
        }
        else {
          emptyError = true;
        }

        // If validation fails, show error message
        if(emtpyError == true){  
         // missing password or email
          showSimpleDialogue('Whoops!', 'Please enter a valid email and password.');

          return false;
        }        
    //    $.support.cors = true;
    //  $.mobile.allowCrossDomainPages = true;
        // Submit the form
        $.getJSON("/Survey_app/survey_phpScripts/survey_login.php?email=" + emailVar.val() + "&password=" + passwordVar.val(), teacherFormVar.serialize(), function(data){
          
            console.log("data: ",data);

              userTagArray = data.Results[0];
              userTagVar = userTagArray[0].User_tag;

              classesArray = data.Results[1];

         	 if (userTagVar != null){
                 
                 if (Modernizr.sessionstorage) {
                      // browser supports local storage
                      sessionStorage.emailVar = emailVar.val();
                      sessionStorage.userTagVar = userTagVar;
                      sessionStorage.classesArray = JSON.stringify(classesArray);
                      sessionStorage.loggedIn = 'true';
                  }
                  else {
                      $.cookie("emailVar",emailVar.val());
                      $.cookie("userTagVar",userTagVar);
                      $.cookie("loggedIn","true");
                      $.cookie("classesArray",JSON.strinify(classesArray));
                  }
         		     
                $.mobile.changePage( "dashboard.html", { transition: "slide"} );
    		 }
         else if (data.Results === 'Not Active'){

                passwordVar = '';
                $('#password').val('');
                showSimpleDialogue('Whoops!','Your account has not been activated yet. Please check the email you registered with to verify the account.');
         }  
    		 else{
          		 	// show error message
                // wrong password or email
                passwordVar = '';
                $('#password').val('');
                showSimpleDialogue('Whoops!','Invalid email or password.');
              
            }
          });
                return false;
        }
        else {

          showSimpleDialogue('No Internet!','Either it\'s the apocalypse or you just have really poor service...');
          return false;
        }    

    });   

    
  </script>
</div> <!-- page1 -->


<!-- Page ends here -->
</body>
</html>
