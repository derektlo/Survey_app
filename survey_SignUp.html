<!DOCTYPE html> 
<html> 
  <head> 
      <meta name="viewport" content="height=device-height,width=device-width,initial-scale=1.0,maximum-scale=1.0" >
  <title>Sign up</title> 

    <link rel="stylesheet" href="./signup.css">
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.css" />
<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.js"></script>
  
  <script>   
   // Global declarations - assignments made in $(document).ready() below
    var hdrMainvar = null;
    var navMainVar = null;
    var contentMainVar = null;
    var ftrMainVar = null;
    var contentTransitionVar = null;

    var emailVar = null;
    var userTagVar = null;
    var  passwordVar = null;
    var passwordAgainVar = null;

    var signUpFormVar = null;
    var confirmationVar = null;
    var passwordMisMatchVar = null;
    var userTagTakenVar = null;

    var contentDialogVar = null;
    var hdrConfirmationVar = null; 
    var contentConfirmationVar = null;
    var ftrConfirmationVar = null;
    var inputMapVar = null;


    var MISSING = "missing";
    var EMPTY = "";

  </script>

</head> 
<body> 

<!-- Page starts here -->
<div data-role="page" data-theme="b" id="signUp" data-add-back-btn="true">

  <div data-role="header" id="hdrMain" name="hdrMain">
    <a href="student.html" data-transition="flip">Student</a>
    <h1>Class Tempo</h1>
  </div>

    <div data-role="navbar" id="navbar">
      <ul>
        <li><a href="teacher.html" rel="external" data-icon="" data-transition="fade">Sign-In</a></li>
        <li><a href="" data-icon="" data-transition="fade" class="ui-btn-active ui-state-persist">Sign-Up</a></li>
      </ul>
    </div>


  <div data-role="content" id="contentMain" name="contentMain"> 

  <form id="signUpForm">
  
  <div id="emailDiv" data-role="fieldcontain">
    <label for="email">Email*</label>   
    <input id="email" name="email_r" type="text" />
  </div>

  <div id="surveyTagDiv" data-role="fieldcontain">
    <label for="userTag">Survey Tag* (Visible to Users, should ID you in some way...)</label>   
    <input id="userTag" name="userTag_r" type="text" />
  </div>

  <div id="passwordDiv" data-role="fieldcontain">
    <label for="password">Password*</label>   
    <input id="password" name="password_r" type="password" />
  </div>

  <div id="passwordAgainDiv" data-role="fieldcontain">
    <label for="passwordAgain">Password Again*</label>    
    <input id="passwordAgain" name="passwordAgain_r" type="password" />
  </div>

    <div id="signUpDiv" data-role="fieldcontain">    
     <input type="submit" value="Sign Up" data-inline="true"/>
    </div>
    </form>
  </div><!-- contentMain -->
  
  <div data-role="footer" id="ftrMain" name="ftrMain"></div>
  
  <div align="CENTER" data-role="content" id="contentDialog" name="contentDialog">  
   <div>Please fill in all fields before submitting the form.</div>
   <a id="buttonOK" name="buttonOK" href="#signUp" data-role="button" data-inline="true">OK</a>
  </div>  <!-- contentDialog -->
  

  <div align="CENTER" data-role="content" id="passwordMisMatch" name="passwordMisMatch">  
   <div>Passwords must match.</div>
   <a id="buttonOKPassword" name="buttonOKPassword" href="#signUp" data-role="button" data-inline="true">OK</a>
  </div>  <!-- passwordMisMatch -->

  <div align="CENTER" data-role="content" id="userTagTaken" name="userTagTaken">  
   <div>The "user tag" you entered is already in use. Please choose a different tag. Thanks!</div>
   <a id="buttonOKUserTag" name="buttonOKUserTag" href="#signUp" data-role="button" data-inline="true">OK</a>
  </div>  <!-- passwordMisMatch -->

  <!-- contentTransition is displayed after the form is submitted until a response is received back. -->
  <div data-role="content" id="contentTransition" name="contentTransition"> 
   <div align="CENTER"><h4>Your account has been created!</h4></div>
  </div>  <!-- contentTransition -->
  
  <!-- Although stored within page1 div tag, hdrConfirmation, contentConfirmation and ftrConfirmation represent a self contained 'confirmation page' -->
  <div data-role="header"  id="hdrConfirmation" name="hdrConfirmation" data-nobackbtn="true">
    <h1>Success</h1>
  </div>
  
  <div data-role="content" id="contentConfirmation" name="contentConfirmation" align="center">
    <p>Your Account has been successfully created.</p> 
    <a id="accountCreatedButton" name="accountCreatedButton" href="#signUp" data-role="button" data-inline="true">OK</a>
  </div><!-- contentConfirmation -->  
    
  <div data-role="footer" id="ftrConfirmation" name="ftrConfirmation"></div> 
  
  
  <script>
   
    $(document).ready(function() {
    // Assign global variables
       hdrMainVar = $('#hdrMain');
       navMainVar = $('#navbar');
      contentMainVar = $('#contentMain');
      ftrMainVar = $('#ftrMain');
      contentTransitionVar = $('#contentTransition');

      emailVar = $('#email');
      userTagVar = $('#userTag');
      passwordVar = $('#password');
      passwordAgainVar = $('#passwordAgain');
      userTagTakenVar = $('#userTagTaken');

      stateVar = $('#state');
      whatVar = $('#what');
      signUpFormVar = $('#signUpForm');
      confirmationVar = $('#confirmation');
      contentDialogVar = $('#contentDialog');
      passwordMisMatchVar = $('#passwordMisMatch');

      hdrConfirmationVar = $('#hdrConfirmation');
      contentConfirmationVar = $('#contentConfirmation');
      ftrConfirmationVar = $('#ftrConfirmation'); 
      inputMapVar = $('input[name*="_r"]');
      
      hideContentDialog();
      hidePasswordMisMatch();
      hideUserTagTaken();
      hideContentTransition();
      hideConfirmation();
    }); 
  
    $('#buttonOK').click(function() {
      
      hideContentDialog();
      hidePasswordMisMatch();
      showMain();
      return false;      
    });

    $('#buttonOKPassword').click(function() {

      hidePasswordMisMatch();
      showMain();
      return false;      
    });

     $('#buttonOKUserTag').click(function() {

      hideUserTagTaken();
      showMain();
      return false;      
    });

    $('#accountCreatedButton').click(function() {

        // show the user surveyList.html
        $.mobile.changePage( "surveyList.html", { transition : "slide "});
    });
   
    
    $('#signUpForm').submit(function() {
        var err = false;
        var passwordError = false;
        
        // Hide the Main content
        hideMain();
        
        // Reset the previously highlighted form elements
        inputMapVar.each(function(index){              
          $(this).prev().removeClass(MISSING); 
        });

        // Perform form validation
        inputMapVar.each(function(index){  
        if($(this).val()==null || $(this).val()==EMPTY){  
            $(this).prev().addClass(MISSING);            
            err = true;
          }          
        });
          console.log(passwordVar.val());
          console.log(passwordAgainVar.val());
          console.log(userTagVar.val());


        if(passwordVar.val() != passwordAgainVar.val()){

          passwordVar.addClass(MISSING);
          passwordAgainVar.addClass(MISSING);
          
          err = true;
          passwordError = true;
        }   

        // If validation fails, show Dialog content
        if(err == true){  

        console.log("we've got an issue");

        if (passwordError == true){
          showPasswordMisMatch();
        }
        else{
          showContentDialog();
        }

          return false;
        }        
        
        $emailVar = emailVar.val();
        $userTag = userTagVar.val();
        $password = passwordVar.val();

        console.log("EMAILLLLL: ",email);



        // Submit the form
        $.post("http://classtempo.org/Survey_app/survey_phpScripts/create_survey_account.php?email=" + emailVar + "&userTag=" + userTagVar.val() + "&password=" + passwordVar.val(), signUpFormVar.serialize(), function(data){
          
          console.log(data);
            if (data == 'Successful'){

              sessionStorage.mySessionEmail = emailVar;
              $.mobile.changePage("surveyList.html",{transition:"slide"});

                          hideContentTransition();
            }
            else if (data == 'Email already exists.') {
             
              showContentDialog();
             hideConfirmation();
            }
            else if (data == 'User tag already exists.')

                showUserTagTaken();
                hideContentTransition();
                hideConfirmation();
        });        
        return false;      
    });   
    
  function hideMain(){
    navMainVar.hide();
    contentMainVar.hide();
    ftrMainVar.hide();   
   }
   
  function showMain(){
    navMainVar.show();
    contentMainVar.show();
    ftrMainVar.show();
   }
   
   function hideContentTransition(){
    contentTransitionVar.hide();
   }      
   
   function showContentTransition(){
    contentTransitionVar.show();
   }  
   
  function hideContentDialog(){
    contentDialogVar.hide();
   }   
   
   function showContentDialog(){
    contentDialogVar.show();
   }

     function showPasswordMisMatch(){
    passwordMisMatchVar.show();
   }

     function hidePasswordMisMatch(){
    passwordMisMatchVar.hide();
   }   
      function showUserTagTaken(){
    userTagTakenVar.show();
   }

     function hideUserTagTaken(){
     userTagTakenVar.hide();
   }   
   
   
   
   function hideConfirmation(){
    hdrConfirmationVar.hide();
    contentConfirmationVar.hide();
    ftrConfirmationVar.hide();
   }  
   
   function showConfirmation(){
    hdrConfirmationVar.show();
    contentConfirmationVar.show();
    ftrConfirmationVar.show();
   } 

    
  </script>
</div> <!-- signUp -->


<!-- Page ends here -->
</body>
</html>
