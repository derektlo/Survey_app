<!DOCTYPE html>
<html>
<head>
 	 <meta name="viewport" content="height=device-height,width=device-width,initial-scale=1.0,maximum-scale=1.0" >
	<title>First jQuery Mobile Example</title>

  <!-- CSS -->
  <link rel="stylesheet" href="./signup.css">
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.css" />
  <link rel="stylesheet" type="text/css" href="simpleDialog2/jquery.mobile.simpledialog.min.css" />  

  <!-- Modernizer -->
  <script type="text/javascript" src="./modernizr.custom.56582.js"></script>
  <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.js"></script>

   <!-- simpleDiaglo2 -->
  <script src="simpleDialog2/jquery.mobile.simpledialog2.min.js"></script>

</head>

<body>
	
	<section id="userSurvey" data-role="page" data-theme="b">
<script>

function incrementOptionValue(optionName) {

	// if optionName is a letter, convert it from ascii to character
		if (optionName > 1000){
			optionName = optionName - 5000;
			optionName = String.fromCharCode(optionName);
		}

		console.log(optionName);

	  $.post("http://classtempo.org/Survey_app/survey_phpScripts/post_option.php?surveyAuthKey=alo-1&optionName=" + optionName,function(result){
    			console.log("called back, ",result);
  });
}

function convertASCIItoCharacter(asciiNum) {
		return String.fromCharCode(asciiNum);
}

	$('#userSurvey').live('pageshow', function(){

	var surveyAuthKey;

	if (Modernizr.sessionstorage) {
	num_options = sessionStorage.num_options;
    numbersOrLetters = sessionStorage.numbersOrLetters;
    surveyID = sessionStorage.surveyID;	
    surveyTokenVar = sessionStorage.surveyToken;
	}
	else {
		num_options = $.cookie("num_options");
		numbersOrLetters = $.cookie("numbersOrLetters");
		surveyID = $.cookie("surveyID");
	}

			var alphabet = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'];

			if (numbersOrLetters === 0)
				{
				for (i = 0; i < num_options; i++){
	
					//$('ul#optionsList').append('<li><a href="javascript:void(incrementOptionValue(' + (i+1) + '));">' + (i+ 1) + ' .</a></li>');
					$('#optionsList').append('<input type="radio" name="options" id="' + (i+1) + '" value="' + (i+1) + '" />');
				      $('#optionsList').append('<label for="' + (i+1) + '" >' + (i+1) + '</label>');
					}
				}
				else {
					for (i = 0; i < num_options; i++){
	
					$('#optionsList').append('<input type="radio" name="options" id="' +alphabet[i] + '" value="' + alphabet[i] + '" />');
				      $('#optionsList').append('<label for="' + alphabet[i] + '" >' + alphabet[i] + '</label>');
					}
				}

				// Append header with survey token
				$('#header').append('<h1>' + surveyTokenVar + ' Survey</h1>');


				// Get Today's Date
				var currentTime = new Date();
				var month = currentTime.getMonth() + 1;
				var day = currentTime.getDate();
				var year = currentTime.getFullYear();
				var fullDate = month + "-" + day + "-" + year;

				// Append todays date to footer
				$('#footer').append('<p>  Today: ' + fullDate + '</p>');
				
				// refresh styles
				$('#userSurvey').trigger("create");
				$("input[type='radio']").prop("checked",false).checkboxradio("refresh");
				
	});


</script>

		<header data-role="header" id="header">
		</header>

		<div data-role="content">

		<div id="optionsContainer">

			  	<fieldset data-role="controlgroup" id="optionsList">
  					<legend>Survey Options</legend>
				</fieldset>

		</div>
    	</div>

			 <form id="form2">
			        <div id="submitUserSurvey" data-role="fieldcontain">    
			     	<a id="submitSurvey" name="submitSurvey" data-role="button" data-inline="true">Submit</a>
			    	</div>
			</form>


<footer data-role="footer" id="footer"></footer>


<script>

 $('#submitSurvey').click(function() {

 	// Present dialog to confirm that the user actually wants
 	// to submit their survey

        var err = false;
        var surveyValue;
            $('input[name=options]').each(function() { 
            surveyValue = $('input[name=options]:checked').val();
        });        
            console.log(surveyValue);
            if (surveyValue === undefined){
            	err = true;
            }

        // If validation fails, show Dialog content
        if(err == true){  

        	$('<div>').simpledialog2({
                    mode: 'button',
                    headerText: 'Whoops!',
                    buttonPrompt: 'Please select an option for this survey.',
                    headerClose: false,
                    buttons : {
                      'OK': {
                        click: function () { 
                        }
                      }
                    }
             });

          return false;
        }        

        // Submit the form
        
        $.post("http://classtempo.org/Survey_app/survey_phpScripts/post_option.php?surveyAuthKey=alo-1&optionName=" + surveyValue, function(data){

        	if (Modernizr.sessionstorage) {
        			sessionStorage.checkStringAlreadySubmitted = sessionStorage.surveyToken + "entered";
        	}
        	else {
        			$.cookie("checkStringAlreadySubmitted",$.cookie("surveyToken") + "entered");
        	}

        	$.mobile.changePage("student.html", {transition : "slideup", reverse : "true"});
        });
             
        return false;      
        
    });   
    

</script>


</section>

	</body>

</head>
</html>