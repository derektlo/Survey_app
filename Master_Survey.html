<!DOCTYPE html> 
<html> 
  <head> 
  <meta name="viewport" content="height=device-height,width=device-width,initial-scale=1.0,maximum-scale=1.0" >
  <title>Sign up</title> 
<!--
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0a2/jquery.mobile-1.0a2.min.css" />
  <link rel="stylesheet" href="./signup.css">
  <script src="http://code.jquery.com/jquery-1.4.4.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.0a2/jquery.mobile-1.0a2.min.js"></script>
  -->
    <link rel="stylesheet" href="./signup.css">
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.css" />
<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
<script src="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.js"></script>
  <script>   

   // Global declarations - assignments made in $(document).ready() below
    var hdrMainvar = null;
    var contentMainVar = null;
    var ftrMainVar = null;
    var contentTransitionVar = null;

    // Used for Master_Survey.html to log in
    var emailVar = null;
    var  passwordVar = null;

    var userTagVar = null;

    // Global vars used in surveyCreator.html
    var sliderValue = null;
    var numbersOrLetters = null;
    var onOffValue = null;
    var surveyDescriptionVar = null;

    // Global var used in surveyList.html
    // to retrieve a survey to display analytics
    var surveyId = null;

    // used in surveyList.html to pass to surveyResults.html
    // to determine flip toggle in surveyResults.html
    var surveyOnorOff = null;

    var form1var = null;
    var confirmationVar = null;
    var incorrectPasswordVar = null;

    var contentDialogVar = null;
    var hdrConfirmationVar = null; 
    var contentConfirmationVar = null;
    var ftrConfirmationVar = null;
    var inputMapVar = null;


    var MISSING = "missing";
    var EMPTY = "";

  </script>

</head> 
<body> 

<!-- Page starts here -->
<div data-role="page" data-theme="b" id="page1">

  <div data-role="header" id="hdrMain" name="hdrMain" data-nobackbtn="true">
    <h1>Class Tempo</h1>
  </div>

      <div data-role="navbar">
      <ul>
        <li><a href="" data-icon="" data-transition="fade" class="ui-btn-active ui-state-persist">Sign-In</a></li>
        <li><a href="survey_SignUp.html" rel="external" data-icon="" data-transition="fade">Sign-Up</a></li>
      </ul>
    </div>


  <div data-role="content" id="contentMain" name="contentMain"> 

  <form id="form1">
  
  <div id="emailDiv" data-role="fieldcontain">
    <label for="email">Email</label>   
    <input id="email" name="email_r" type="text" />
  </div>

  <div id="passwordDiv" data-role="fieldcontain">
    <label for="password">Password</label>   
    <input id="password" name="password_r" type="password" />
  </div>

    <div id="signInDiv" data-role="fieldcontain">    
     <input type="submit" value="Sign In" data-inline="true"/>
    </div>
    </form>
  </div><!-- contentMain -->
  
  <div data-role="footer" id="ftrMain" name="ftrMain"></div>
  
  <div align="CENTER" data-role="content" id="contentDialog" name="contentDialog">  
   <div>Please fill in an email and password.</div>
   <a id="buttonOK" name="buttonOK" href="#page1" data-role="button" data-inline="true">OK</a>
  </div>  <!-- contentDialog -->
  

  <div align="CENTER" data-role="content" id="incorrectPassword" name="incorrectPassword">  
   <div>Incorrect password or email.</div>
   <a id="buttonOKPassword" name="buttonOKPassword" href="#page1" data-role="button" data-inline="true">OK</a>
  </div>  <!-- contentDialog -->
    
  <div data-role="footer" id="ftrConfirmation" name="ftrConfirmation"></div> 
  
  
  <script>
   
    $(document).ready(function() {

  //check the navigator.userAgent string to detect if the user is using an iPhone
    if (navigator.userAgent.match(/iPhone/i)) {

        //cache the viewport tag if the user is using an iPhone
        var $viewport = $('head').children('meta[name="viewport"]');

        //bind an event handler to the window object for the orientationchange event
        $(window).bind('orientationchange', function() {
            if (window.orientation == 90 || window.orientation == -90 || window.orientation == 270) {

                //landscape
                $viewport.attr('content', 'height=device-width,width=device-height,initial-scale=1.0,maximum-scale=1.0');
            } else {

                //portrait
                $viewport.attr('content', 'height=device-height,width=device-width,initial-scale=1.0,maximum-scale=1.0');
            }

        //trigger an orientationchange event on the window object to initialize this code (basically in-case the user opens the page in landscape mode)
        }).trigger('orientationchange');
    }
    


    // Assign global variables
       hdrMainVar = $('#hdrMain');
      contentMainVar = $('#contentMain');
      ftrMainVar = $('#ftrMain');
      contentTransitionVar = $('#contentTransition');

      emailVar = $('#email');
      passwordVar = $('#password');

      form1Var = $('#form1');
      confirmationVar = $('#confirmation');
      contentDialogVar = $('#contentDialog');
      incorrectPasswordVar = $('#incorrectPassword');

      hdrConfirmationVar = $('#hdrConfirmation');
      contentConfirmationVar = $('#contentConfirmation');
      ftrConfirmationVar = $('#ftrConfirmation'); 
      inputMapVar = $('input[name*="_r"]');
      
      hideContentDialog();
      hidePasswordMisMatch();
      hideContentTransition();
      hideConfirmation();
    }); 
  
    $('#buttonOK').click(function() {
      console.log("hmmm");
      hideContentDialog();
      showMain();
      return false;      
    });

    $('#buttonOKPassword').click(function() {

      console.log("hmmm");
      hidePasswordMisMatch();
      showMain();
      return false;      
    });
   
    
    $('#form1').submit(function() {
        var err = false;
        var passwordError = false;
        
        // Hide the Main content
       // hideMain();
        
         // Reset the previously highlighted form elements
        inputMapVar.each(function(index){              
          $(this).prev().removeClass(MISSING); 
        });

        if (emailVar.val() == EMPTY){
        	err = true;
        }
        else if (passwordVar == EMPTY){
        	err = true;
        }

        // If validation fails, show Dialog content
        if(err == true){  

        console.log("we've got an issue");

          showContentDialog();

          return false;
        }        
        
        
        // If validation passes, show Transition content
        showContentTransition();

        // Submit the form
        $.getJSON("http://iwaiter-app.com/iWaiter_scripts/survey_login.php?email=" + emailVar.val() + "&password=" + passwordVar.val(), form1Var.serialize(), function(data){
          
          userTagVar = data.Results[0].User_tag;

          console.log(userTagVar);


         	 if (userTagVar != ''){

         		$.mobile.changePage( "surveyList.html", { transition: "slide"} );
    		 }
    		 else{
    		 	// show error message
          showPasswordMisMatch();
    		 }
        });        
        return false;      
    });   
    
  function hideMain(){
    hdrMainVar.hide();
    contentMainVar.hide();
    ftrMainVar.hide();   
   }
   
  function showMain(){
    hdrMainVar.show();
    contentMainVar.show();
    ftrMainVar.show();
   }
   
   function hideContentTransition(){
    contentTransitionVar.hide();
   }      
   
   function showContentTransition(){
    contentTransitionVar.show();
   }  
   
  function hideContentDialog(){
    contentDialogVar.hide();
   }   
   
   function showContentDialog(){
    contentDialogVar.show();
   }

     function showPasswordMisMatch(){
    incorrectPasswordVar.show();
   }

     function hidePasswordMisMatch(){
    incorrectPasswordVar.hide();
   }   
   
   
   function hideConfirmation(){
    hdrConfirmationVar.hide();
    contentConfirmationVar.hide();
    ftrConfirmationVar.hide();
   }  
   
   function showConfirmation(){
   // hdrConfirmationVar.show();
   // contentConfirmationVar.show();
   // ftrConfirmationVar.show();
   	
   } 

    
  </script>
</div> <!-- page1 -->


<!-- Page ends here -->
</body>
</html>
