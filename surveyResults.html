<!DOCTYPE html> 
<html> 
  <head> 
      <meta name="viewport" content="height=device-height,width=device-width,initial-scale=1.0,maximum-scale=1.0" >
  <title>Class Tempo: Survey Results</title> 
  
  <!-- CSS -->
  <link rel="stylesheet" href="./signup.css">
    <link rel="stylesheet" href="./teacher-theme/themes/Class-Tempo-Teacher.min.css" />
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.1/jquery.mobile.structure-1.1.1.min.css" />
<!--   <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.css" /> -->
    <link rel="stylesheet" type="text/css" href="simpleDialog2/jquery.mobile.simpledialog.min.css" />  
  
  <!-- Modernizer -->
  <script type="text/javascript" src="./modernizr.custom.56582.js"></script>
  
  <!-- jQuery/jQuery Mobile -->
  <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.1.1/jquery.mobile-1.1.1.min.js"></script>
  
  <!-- jqPlot -->
  <!--[if lt IE 9]><script language="javascript" type="text/javascript" src="js/excanvas.js"></script><![endif]-->
  <script language="javascript" type="text/javascript" src="js/jquery.jqplot.min.js"></script>
  <link rel="stylesheet" type="text/css" href="js/jquery.jqplot.css" />

  <script language="javascript" type="text/javascript" src="js/plugins/jqplot.barRenderer.js"></script>
  <script language="javascript" type="text/javascript" src="js/plugins/jqplot.barRenderer.min.js"></script>
  <script language="javascript" type="text/javascript" src="js/plugins/jqplot.categoryAxisRenderer.js"></script>
  <script language="javascript" type="text/javascript" src="js/plugins/jqplot.pointLabels.js"></script>
  <script language="javascript" type="text/javascript" src="js/plugins/jqplot.pointLabels.min.js"></script>

</head> 


<body> 

<!-- Page starts here -->
<div data-role="page" data-theme="a" id="surveyResultsPage" data-add-back-btn="true">
<!-- <div data-role="page" data-theme="b" id="surveyResultsPage" data-add-back-btn="true"> -->

<script>

// Definition of Global Variable
  var surveyType = null;
  var surveyTag = null;

</script>

<style>
  #chart1 {
    width:98%;
    height: 30%;
  }
  #onOffSection {
    margin-top:10px;
  }

</style>

  <div data-role="header" id="hdrMain" name="hdrMain">
     <a href="mySurveys.html" data-direction="reverse" rel="external" data-icon="back" data-transition="slide" class="ui-btn-left">Back</a>

    <h1>Class Tempo</h1>
    <a href="surveyResults.html" rel="external" data-icon="refresh" class="ui-btn-right">refresh</a>
  </div>

  <div data-role="content" id="surveyCreatorContent" name="surveyCreatorContent"> 
      
      <div id="chart1" style="">
      </div>

      <div id="specificResponseMatching">
      <ul id="matchingResults" data-role="listview" data-inset="true">
      </ul>
      </div>

      <div id="specificResponse">
      <ul id="specificResponseResults" data-role="listview" data-inset="true">
      </ul>
      </div>

      <div id="onOffSection">
      <label for="surveyOnOff" >Survey ON/OFF:</label>
      <select name="surveyOnOff" id="surveyOnOff" data-role="slider" data-theme="c" data-track-theme="a">
        <option value="off">Off</option>
        <option value="on">On</option>
      </select>
    </div>

  
  </div><!-- contentMain -->
  
  <div data-role="footer" id="ftrMain" name="ftrMain"></div>

  <script>

function returnTicks(results){
        var ticks = [];
        var surveyType;

      if (Modernizr.sessionstorage){
            surveyType = sessionStorage.surveyType;
      }
      else {
            surveyType = $.cookie("surveyType");
      }

          if (surveyType === 'Numbers') {

              for (var i = 0; i < results.length; i++){
                  ticks.push(i+1);
              }
          }
          else if (surveyType === 'Letters') {
            var alphabet = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'];

            // Add ticks for the x-axis
            ticks = alphabet.slice(0,results.length);
          }
        
        return ticks;    
}

 $(document).ready(function() { 

          // Load Graph 

       surveyTag = sessionStorage.surveyTag;
       surveyType = sessionStorage.surveyType;
        
//           // Load Graph 
           $.getJSON("http://classtempo.org/Survey_app/survey_phpScripts/getSurveyAnalytics.php?surveyAuthKey=" + surveyTag + "&surveyType=" + surveyType, function(json) {

              $.jqplot.config.enablePlugins = true;

              // Define local variables used to create graph
              var arrayOfValues = json.Results[0];
              var arrayOfPercents = json.Results[1];
              var arrayOfPointLabels = [];  
              var ticks = returnTicks(json.Results[0]);

              // Add Point Labels
              for (var i = 0; i < arrayOfValues.length; i++){
                  arrayOfPointLabels.push(arrayOfValues[i] + ", " + arrayOfPercents[i]);
              }

              // Get array of ints to actually plot data
              var arrayOfValuesNumbers = arrayOfValues.map(Number);;

              plot1 = $.jqplot('chart1', [arrayOfValuesNumbers], {
                  // Only animate if we're not using excanvas (not in IE 7 or IE 8)..
                  animate: !$.jqplot.use_excanvas,
                  title: sessionStorage.surveyTag + ' Results',
                  seriesDefaults:{
                      renderer:$.jqplot.BarRenderer,
                      rendererOptions:{ 
                        varyBarColor : true ,
                      animation: {speed: 1000} },
                      pointLabels: {show: true}
                  },
                  series:[
                    {pointLabels:{
                                  show: true,
                                  labels:arrayOfPointLabels,
                                  ypadding: 12,
                                }}],
                  axes: {
                      xaxis: {
                          renderer: $.jqplot.CategoryAxisRenderer,
                          ticks: ticks
                      }
                  },
                  highlighter: { show: false },
                  seriesColors: $.merge([ "#55A9D3", "#D4EDE2", "#EA2E49"], $.jqplot.config.defaultColors)
              });

              // Load other analytics
                /*
                $('#resultsList').children().remove('li');

                $('ul#resultsList').append('<li>Mean: </li>');
                $('ul#resultsList').append('<li>Standard Deviation: </li>');

                $('ul#resultsList').listview();
                $('ul#resultsList').listview('refresh');
                */

                // set On or Off
                if (Modernizr.sessionstorage) {
                    var onOffValue = sessionStorage.onOffValue;
                }
                else {
                  var onOffValue = $.cookie("onOffValue");
                }

                if (onOffValue == 'On')
                  $('#surveyOnOff').val('on').slider("refresh");
                else
                  $('#surveyOnOff').val('off').slider("refresh");
             
             }); // END JSON CALLBACK
  });

//     $(document).ready(function() { 

//       surveyTag = sessionStorage.surveyTag;
//       surveyType = sessionStorage.surveyType;
        
//           // Load Graph 
//           $.getJSON("http://classtempo.org/Survey_app/survey_phpScripts/getSurveyAnalytics.php?surveyAuthKey=" + surveyTag + "&surveyType=" + surveyType, function(json) {
//             console.log("json: ",json);

//               $.jqplot.config.enablePlugins = true;

//               // Define local variables used to create graph
//               var arrayOfValues = json.Results[0];
//               var arrayOfPercents = json.Results[1];
//               var arrayOfPointLabels = [];
//               var ticks;

//            //   if ((surveyType === 'Numbers') || (surveyType === 'Letters')) {  
//             if (surveyType === 'Numbers') {
//                  ticks = returnTicks(json.Results[0]);
//                }
//               else if (surveyType === 'Custom') {
//                  ticks = json.Results[2];
//                }

//               // Add Point Labels
//               for (var i = 0; i < arrayOfValues.length; i++){
//                   arrayOfPointLabels.push(arrayOfValues[i] + ", " + arrayOfPercents[i]);
//               }

//               // Get array of ints to actually plot data
//               var arrayOfValuesNumbers = arrayOfValues.map(Number);

//               plot1 = $.jqplot('chart1', [arrayOfValuesNumbers], {
//                   // Only animate if we're not using excanvas (not in IE 7 or IE 8)..
//                   animate: !$.jqplot.use_excanvas,
//                   title: sessionStorage.surveyTag + ' Results',
//                   seriesDefaults:{
//                       renderer:$.jqplot.BarRenderer,
//                       rendererOptions:{ 
//                         varyBarColor : true ,
//                       animation: {speed: 1000} },
//                       pointLabels: {show: true}
//                   },
//                   series:[
//                     {pointLabels:{
//                                   show: true,
//                                   labels:arrayOfPointLabels,
//                                   ypadding: 12,
//                                 }}],
//                   axes: {
//                       xaxis: {
//                           renderer: $.jqplot.CategoryAxisRenderer,
//                           ticks: ticks
//                       }
//                   },
//                   highlighter: { show: false },
//                   seriesColors: $.merge([ "#55A9D3", "#D4EDE2", "#EA2E49"], $.jqplot.config.defaultColors)
//                 }
//           });

//               // Load other analytics
//               var onOffValue;
//               console.log("onoffvalue: ",sessionStorage.onOffValue);
//                 // set On or Off
//                 if (Modernizr.sessionstorage) {
//                     onOffValue = sessionStorage.onOffValue;
//                 }
//                 else {
//                   onOffValue = $.cookie("onOffValue");
//                 }

//                 if (onOffValue === 'On') {
//                   $('#surveyOnOff').val('on').slider("refresh");
//                 }
//                 else {
//                   $('#surveyOnOff').val('off').slider("refresh");
//                 }

// });

    $('#surveyOnOff').change(function() {

      console.log($('#surveyOnOff').val());

      var currentOnOffValue;
      
      if ($('#surveyOnOff').val() === 'on')
        currentOnOffValue = 0;
      else
        currentOnOffValue = 1;

     $.post("http://classtempo.org/Survey_app/survey_phpScripts/set_survey_onOff.php?surveyID=" + surveyId + "&onOff=" + currentOnOffValue,function(response){

     });
    });

  </script>
</div> <!-- page1 -->


<!-- Page ends here -->
</body>
</html>
